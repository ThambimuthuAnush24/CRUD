<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create New Product</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .form-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
        }
        .form-container:hover {
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        }
        .form-header {
            background: linear-gradient(90deg, #3498db, #2980b9);
            color: white;
            border-radius: 12px 12px 0 0;
        }
        .input-field {
            transition: all 0.3s;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
        }
        .input-field:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        .btn-submit {
            background: linear-gradient(90deg, #3498db, #2980b9);
            transition: all 0.3s;
        }
        .btn-submit:hover {
            background: linear-gradient(90deg, #2980b9, #3498db);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .btn-cancel {
            transition: all 0.3s;
        }
        .btn-cancel:hover {
            background-color: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        }
        .error-message {
            color: #e53e3e;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }
        .file-name {
            color: #4a5568;
            font-size: 0.875rem;
            margin-top: 0.5rem;
            text-align: center;
        }
    </style>
</head>
<body>
<div class="form-container w-full max-w-2xl mx-4">
    <div class="form-header py-4 px-6">
        <h1 class="text-2xl font-bold text-center"><i class="fas fa-plus-circle mr-2"></i>New Product</h1>
    </div>

    <form th:action="@{/products/create}" th:object="${productDto}" method="post" enctype="multipart/form-data" class="px-8 py-6" id="productForm">
        <!-- Name Field -->
        <div class="mb-6">
            <label class="block text-gray-700 font-medium mb-2" for="name">
                <i class="fas fa-tag mr-2 text-blue-500"></i>Name
            </label>
            <input class="input-field w-full px-4 py-3" type="text" id="name" th:field="*{name}" placeholder="Enter product name" required>
            <div class="error-message" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
        </div>

        <!-- Brand Field -->
        <div class="mb-6">
            <label class="block text-gray-700 font-medium mb-2" for="brand">
                <i class="fas fa-building mr-2 text-blue-500"></i>Brand
            </label>
            <input class="input-field w-full px-4 py-3" type="text" id="brand" th:field="*{brand}" placeholder="Enter brand name" required>
            <div class="error-message" th:if="${#fields.hasErrors('brand')}" th:errors="*{brand}"></div>
        </div>

        <!-- Category Field -->
        <div class="mb-6">
            <label class="block text-gray-700 font-medium mb-2" for="category">
                <i class="fas fa-list-alt mr-2 text-blue-500"></i>Category
            </label>
            <select class="input-field w-full px-4 py-3" id="category" th:field="*{category}" required>
                <option value="">Select a category</option>
                <option value="Laptop">Laptop</option>
                <option value="Mobilephone">Mobilephone</option>
                <option value="Earphone">Earphone</option>
                <option value="Charger">Charger</option>
                <option value="Television">Television</option>
            </select>
            <div class="error-message" th:if="${#fields.hasErrors('category')}" th:errors="*{category}"></div>
        </div>

        <!-- Price Field -->
        <div class="mb-6">
            <label class="block text-gray-700 font-medium mb-2" for="price">
                <i class="fas fa-dollar-sign mr-2 text-blue-500"></i>Price
            </label>
            <input class="input-field w-full px-4 py-3" type="number" id="price" th:field="*{price}" placeholder="0.00" step="0.01" min="0" required>
            <div class="error-message" th:if="${#fields.hasErrors('price')}" th:errors="*{price}"></div>
        </div>

        <!-- Description Field -->
        <div class="mb-6">
            <label class="block text-gray-700 font-medium mb-2" for="description">
                <i class="fas fa-align-left mr-2 text-blue-500"></i>Description (min. 10 characters)
            </label>
            <textarea class="input-field w-full px-4 py-3" id="description" th:field="*{description}" rows="3" placeholder="Enter product description (min. 10 characters)" required minlength="10"></textarea>
            <div class="error-message" th:if="${#fields.hasErrors('description')}" th:errors="*{description}"></div>
        </div>

        <!-- Image Upload Field -->
        <div class="mb-8">
            <label class="block text-gray-700 font-medium mb-2" for="imageFile">
                <i class="fas fa-image mr-2 text-blue-500"></i>Image
            </label>
            <div class="flex items-center justify-center w-full">
                <label class="input-field flex flex-col items-center justify-center w-full border-2 border-dashed rounded-lg cursor-pointer py-8" id="fileUploadArea">
                    <div id="uploadPrompt" class="flex flex-col items-center justify-center">
                        <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"></i>
                        <p class="text-sm text-gray-500">Click to upload or drag and drop</p>
                        <p class="text-xs text-gray-400 mt-1">SVG, PNG, JPG or GIF (MAX. 5MB)</p>
                    </div>
                    <div id="fileInfo" class="hidden flex-col items-center justify-center">
                        <i class="fas fa-file-image text-3xl text-green-500 mb-2"></i>
                        <p id="fileName" class="text-sm text-gray-700"></p>
                        <p class="text-xs text-gray-500 mt-1">Click to change</p>
                    </div>
                    <input type="file" id="imageFile" name="imageFile" th:field="*{imageFile}" class="hidden" accept="image/*" required />
                </label>
            </div>
            <div class="file-name" id="selectedFileName"></div>
            <div class="error-message" th:if="${#fields.hasErrors('imageFile')}" th:errors="*{imageFile}"></div>
        </div>

        <!-- Buttons -->
        <div class="flex justify-between mt-8">
            <a href="/products" class="btn-cancel bg-gray-200 text-gray-800 font-medium px-6 py-3 rounded-lg">
                <i class="fas fa-times mr-2"></i>Cancel
            </a>
            <button type="submit" class="btn-submit text-white font-medium px-6 py-3 rounded-lg">
                <i class="fas fa-check mr-2"></i>Submit
            </button>
        </div>
    </form>
</div>

<script>
    // Add some interactivity to the file input
    const fileInput = document.getElementById('imageFile');
    const fileUploadArea = document.getElementById('fileUploadArea');
    const uploadPrompt = document.getElementById('uploadPrompt');
    const fileInfo = document.getElementById('fileInfo');
    const fileNameDisplay = document.getElementById('fileName');
    const selectedFileName = document.getElementById('selectedFileName');
    const form = document.getElementById('productForm');

    fileInput.addEventListener('change', function(e) {
        if (this.files && this.files[0]) {
            const fileName = this.files[0].name;
            uploadPrompt.classList.add('hidden');
            fileInfo.classList.remove('hidden');
            fileNameDisplay.textContent = fileName;
            selectedFileName.textContent = `Selected file: ${fileName}`;

            // Clear any previous file validation errors
            const errorDiv = document.querySelector('[th\\:errors="*{imageFile}"]');
            if (errorDiv) {
                errorDiv.textContent = '';
            }
        }
    });

    // Add drag and drop functionality
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        fileUploadArea.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    ['dragenter', 'dragover'].forEach(eventName => {
        fileUploadArea.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        fileUploadArea.addEventListener(eventName, unhighlight, false);
    });

    function highlight() {
        fileUploadArea.classList.add('border-blue-400', 'bg-blue-50');
    }

    function unhighlight() {
        fileUploadArea.classList.remove('border-blue-400', 'bg-blue-50');
    }

    fileUploadArea.addEventListener('drop', handleDrop, false);

    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        fileInput.files = files;

        // Trigger the change event
        const event = new Event('change');
        fileInput.dispatchEvent(event);
    }

    // Add form validation
    form.addEventListener('submit', function(e) {
        let isValid = true;

        // Validate description length
        const description = document.getElementById('description');
        if (description.value.length < 10) {
            isValid = false;
            let errorDiv = description.nextElementSibling;
            if (!errorDiv || !errorDiv.classList.contains('error-message')) {
                errorDiv = document.createElement('div');
                errorDiv.className = 'error-message';
                description.parentNode.insertBefore(errorDiv, description.nextSibling);
            }
            errorDiv.textContent = 'The description should be at least 10 characters';
        }

        // Validate file input
        if (!fileInput.files || fileInput.files.length === 0) {
            isValid = false;
            let errorDiv = document.querySelector('[th\\:errors="*{imageFile}"]');
            if (errorDiv) {
                errorDiv.textContent = 'The image file is required';
            }
        }

        if (!isValid) {
            e.preventDefault();
        }
    });
</script>
</body>
</html>